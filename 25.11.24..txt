1. 현재까지 완성된 상태 (출입국 업무관리 앱)
1) 모듈 구조

app.py는 페이지 라우팅/상단 메뉴만 담당.

실제 로직은 각 모듈로 분리:

pages/page_home.py – 홈(등록증/여권 만기 알림, 예정업무/진행업무 일부)

pages/page_customer.py – 고객관리(검색, 행추가, 삭제, 저장, 구글시트 연동)

pages/page_scan.py – 스캔(OCR로 여권+등록증 인식 → 고객관리 자동 반영)

pages/page_daily.py – 일일결산

pages/page_monthly.py – 월간결산(요일별/업무별/시간대별 분석 그래프)

pages/page_manual.py – 메뉴얼 GPT 검색

pages/page_memo.py – 장기/중기 메모 (구글시트 연결)

pages/page_reference.py – 업무참고(구글시트 임베드)

pages/page_document.py – 문서 자동작성(PDF 템플릿 + 도장 생성)

pages/page_completed.py – 완료업무 조회

공통 함수/유틸:

core/customer_service.py – 고객 DF 로드/저장, 스캔 반영 등

core/tasks_service.py – 예정업무/진행업무/완료업무 로드·저장

core/google_sheets.py – 구글시트 read/write

utils/document.py – 도장 이미지 생성(create_seal), PDF 폼 필드 채우기 등

config.py – 시트 이름, 세션키, 기본 상수

2. 각 기능별 핵심 내용 정리
1) 스캔 페이지 (PAGE_SCAN)

Tesseract 경로:

TESSERACT_EXE = r"C:\Program Files\Tesseract-OCR\tesseract.exe" 기준.

parse_passport, parse_arc로 각각 여권 MRZ / 등록증을 분석.

OCR 결과를 scan_한글, scan_성, scan_명, scan_여권, scan_등록증, scan_번호, scan_발급일, scan_만기일, scan_주소 등에 미리 채워놓고, 폼에서 수정 후 저장.

st.form 안에서는 st.button을 추가로 못 쓰므로:

폼 안에서는 st.form_submit_button("💾 고객관리 반영")만 사용.

저장 성공 여부는 st.session_state["scan_saved_ok"]로 표시.

폼 밖에서:

if st.session_state.get("scan_saved_ok"):
    st.success("✅ 고객관리 데이터에 반영이 완료되었습니다.")
if st.button("← 고객관리로 돌아가기", ...):
    st.session_state[SESS_CURRENT_PAGE] = PAGE_CUSTOMER
    st.rerun()


현재 동작:

“고객관리 반영” 시 에러 없이 저장 + 메시지 출력 + 필요하면 고객관리 페이지로 이동.

2) 문서 자동작성 (PAGE_DOCUMENT)

고객 검색(신청인), 숙소제공자, 신원보증인, 미성년자 대리인까지 고객데이터에서 선택.

여권/등록증 번호에서 생년월일·성별 계산 후 PDF 템플릿 필드에 채움.

도장:

utils/document.py:create_seal(circle_path, name, font_path, size) 사용.

현재는 로컬 fonts/ 폴더 + 도장용 폰트 파일 사용 → 정상 작동.

향후 로그인/온라인 버전에서는:

폰트를 서버/저장소(Git, S3 등)에 두고 불러오도록 구조 바꿀 계획(이미 “기억해두기” 완료).

3) 고객관리 (PAGE_CUSTOMER)

구글시트에서 고객 DF 로드 → 최신순(고객ID 기준) 정렬.

검색, 행 추가(YYYYMMDD + 01~99), 삭제(구글시트 행/드라이브 폴더 동기삭제), Undo.

저장 시:

신규 고객은 append_rows_to_sheet로 추가.

기존 고객 변경분은 save_customer_batch_update로 반영.

앞으로 정책:

“고객별 관리 폴더 생성” 기능은 기본 OFF.

Admin이 허용한 행정사사무소(tenant)에만 옵션으로 ON:

지금처럼 폴더를 생성/연동하는 로직은 별도 옵션 플래그로 제어할 예정.

3. 로그인/멀티테넌트 방향 (요약본)
1) 역할 구조

Admin (나): 한우리 본체

전체 시스템 관리, 테넌트(행정사 사무소) 생성/설정, 요금제, 권한.

Customer(행정사 사무소):

일반 “손님” 계정은 없음.

각 사무소는 자기 데이터만 보는 구조(고객, 일정, 결산, 메모 등 모두 분리).

2) 앞으로의 저장소/인프라 방향

장기적으로:

구글 드라이브 의존도↓, Git + DB(or S3 등) 중심 구조로 재설계.

문서 템플릿/폰트/설정파일들을 Git 레포지토리로 관리.

서버에 배포 시 해당 레포를 clone/업데이트하는 방식.

3) 구글 계정/용량 이슈에 대한 방향

문제점:

각 테넌트를 별도 구글 계정/드라이브로 쪼개면, 15GB 무료 제한에 걸림.

캘린더도 계정마다 쪼개면 관리가 복잡.

우선 방향:

Admin 계정의 드라이브/시트에 모든 테넌트 데이터 보관.

각 테넌트는 로그인 후 본인 데이터만 API로 필터링해서 사용.

개인 고객 문서/파일 업로드는 되도록:

서버 파일 스토리지 or S3 등으로 옮기는 쪽을 염두 (드라이브는 옵션).

캘린더:

당장은 공용 시트 기반 일정 → 필요하면 나중에 테넌트별 캘린더 구조 재설계.

4. 개발 순서(우리가 합의한 우선순위)

현재 출입국 업무관리 3가지 보완 먼저

OCR 정교화 (스캔 정확도 안정화, 속도/예외 케이스 보강)

고객관리의 “고객별 폴더” 기능:

기본 비활성화.

Admin이 허용한 사무소만 사용 가능하도록 옵션화.

GPT 메뉴얼 검색/질문 기능 업그레이드:

질문 카테고리화, 프롬프트 개선, 답변 포맷 고정 등.

그 다음에 회원가입 + 로그인 + 멀티테넌트(행정사 사무소) 붙이기

이유:

로그인/멀티테넌트를 먼저 붙이면, 그 위에서 OCR/폴더/GPT를 다시 손볼 때 버그 발생 범위가 더 넓어짐.

반대로, 지금 기능을 최대한 안정화 시켜놓으면, 나중에 로그인 기능은 “겉에서 감싸는 레이어” 역할만 하므로 리스크가 줄어듦.

5. 새 채팅에서 이어갈 때 이렇게 써줘

새 채팅 시작하고 아래 문장만 붙여넣으면 바로 이어서 설명해줄 수 있어:

“이전 채팅에서 출입국 업무관리 앱 모듈화, OCR 스캔, 문서 자동작성, 고객 폴더 옵션화, 그리고 로그인/멀티테넌트 설계(행정사 사무소=커스터머, Admin 단일 구조)에 대해 정리해둔 내용을 이어서 보자. 우선순위는 ① OCR 정교화, ② 고객폴더 옵션화, ③ GPT 메뉴얼 질문 업그레이드 후, ④ 회원가입/로그인 붙이는 순서였어. 그다음 단계부터 같이 진행하자.”